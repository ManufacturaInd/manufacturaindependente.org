$(document).ready(function() {
  var h = new Image();
  h.src = waitImage;
  $("#phplistsubscribeform").submit(function() {
    var d = $("#emailaddress").val();
    var e = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
    var f = this.action;
    ajaxaddress = f.replace(/subscribe/, 'asubscribe');
    $('#phplistsubscriberesult').html('<img src="' + h.src + '" width="' + h.width + '" height="' + h.height + '" border="0" alt="Please wait" title="powered by phpList, www.phplist.com" />');
    if (e.test(d)) {
      console.log('valid email address found')
      var g = $.ajax({
        type: 'POST',
        url: ajaxaddress,
        crossDomain: true,
        data: "email=" + d,
        success: function(a, b, c) {
          if (a.search(/FAIL/) >= 0) {
            document.location = f + "&email=" + d;
            console.log('forwarding to ' + f + "&email=" + d);
          } else {
            $('#phplistsubscriberesult').html("<div id='subscribemessage'></div>");
            $('#subscribemessage').html(a).hide().fadeIn(1500);
            $("#phplistsubscribeform").hide();
            document.cookie = "phplistsubscribed=yes"
          }
        },
        error: function(a, b, c) {
          document.location = f + "&email=" + d
          console.log('error: forwarding to ' + f + "&email=" + d);
        }
      })
    } else {
      console.log('else: forwarding to ' + f + "&email=" + d);
      document.location = f + "&email=" + d
    }
    return false
  });
  $("#emailaddress").val(pleaseEnter);
  $("#emailaddress").focus(function() {
    var v = $("#emailaddress").val();
    if (v == pleaseEnter) {
      $("#emailaddress").val("")
    }
  });
  $("#emailaddress").blur(function() {
    var v = $("#emailaddress").val();
    if (v == "") {
      $("#emailaddress").val(pleaseEnter)
    }
  });
  var i = document.cookie;
  if (i.indexOf('phplistsubscribed=yes') >= 0) {
    $("#phplistsubscribeform").html(thanksForSubscribing)
  }
});
if (pleaseEnter == undefined) {
  var pleaseEnter = "Please enter your email"
}
if (thanksForSubscribing == undefined) {
  var thanksForSubscribing = '<div class="subscribed">Thank you for subscribing. Please click the link in the confirmation email you will receive.</div>'
}
if (waitImage == undefined) {
  var waitImage = 'https://s3.amazonaws.com/phplist/img/busy.gif'
}
